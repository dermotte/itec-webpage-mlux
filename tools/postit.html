<html>
<head>
    <title>Post-It Board</title>
    <script src="../js/jquery-2.2.1.min.js"></script>
    <script src="../js/jquery-ui.min.js"></script>
    <script src="../js/jquery.ui.touch-punch.min.js"></script>
    <script src="../js/loStorage.min.js"></script>
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link href='https://fonts.googleapis.com/css?family=Merienda+One' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../css/jquery-ui.css">
    <style type="text/css">
        body {
            font-family: 'Merienda One';
            color: whitesmoke;
        }

        #board {
            font-family: monospace;
            background-color: #260D04;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .post-it {
            position: absolute !important;
            width: 280px;
            background-color: #FEF1B5;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, .5);
            overflow: hidden;
            font-family: 'Merienda One';
            font-size: 12pt;
        }

        .post-it .header {
            background-color: #FEE5AC;
            text-align: right;
            min-height: 16px;
            padding: 2px;
        }

        .post-it .header:hover {
            background-color: #FFFACD;
        }

        .post-it .header a, .post-it .header a:visited {
            text-decoration: none;
            color: #603311;
            font-weight: bold;
        }

        .post-it .header a:hover {
            color: #D19275;
        }

        .post-it .content {
            padding: 10px;
            min-height: 220px;
            outline: none;
            color: black;
        }

        .newPostIt {
            position: fixed;
            left: 1em;
            top: 1em;
        }

        .wipeBoard {
            position: fixed;
            right: 1em;
            top: 1em;
        }

        .footer {
            position: fixed; right: 1em; bottom: 1em;
        }
    </style>
    <style type="text/css" media="print">
        body {
            font-family: 'Merienda One';
            color: whitesmoke;
        }

        #board {
            font-family: monospace;
            background-color: #FFFFFF;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .post-it {
            position: absolute !important;
            width: 280px;
            background-color: #FEF1B5;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, .5);
            overflow: hidden;
            font-family: 'Merienda One';
            font-size: 12pt;
        }

        .post-it .header {
            background-color: #FEE5AC;
            text-align: right;
            min-height: 16px;
            padding: 2px;
        }

        .post-it .header:hover {
            background-color: #FFFACD;
        }

        .post-it .header a, .post-it .header a:visited {
            text-decoration: none;
            color: #603311;
            font-weight: bold;
        }

        .post-it .header a:hover {
            color: #D19275;
        }

        .post-it .content {
            padding: 10px;
            min-height: 220px;
            outline: none;
            color: black;
        }

        .newPostIt {
            visibility: hidden;
        }

        .footer {
            visibility: hidden;
        }
    </style>
</head>
<body id="board">
<div class="newPostIt"><a href="javascript:newPostIt()" style="color: whitesmoke; font-size: 2em;"><i
        class="fa fa-plus-circle"></i></a></div>
<div class="wipeBoard"><a href="javascript:resetBoard()" style="color: whitesmoke; font-size: 2em;"><i
        class="fa fa-trash"></i></a></div>
<div class="footer" >simple Post-It wall | 2016 | Mathias Lux | <a
        style=" color:whitesmoke; text-decoration: none" href="https://gist.github.com/shmeadyy/7324662"><i
        class="fa fa-code"></i> inspiration</a></div>

<script language="JavaScript">
    var postNumber = -1;
    var postitArray = new Array();

    var Board = function (selector) {
        var $elem = $(selector);

        function initialize() {
            // $elem.on("click", newPostIt);
        };

        initialize();
    };

    var PostIt = function (id, text, x, y) {
//        this.pId = id;
        this.y = y;
        this.x = x;
        this.pText = text;

        function initialize() {
            $("#board").append('<div class="post-it" id="' + id + '"><div class="header"><a class="close" id="close'+id+'" href="#"><i class="fa fa-close"></a></div><div contenteditable="true" id="content'+id+'" class="content"></div></div>')
            $("#" + id).resizable();
            $("#" + id).css({
                'top': y,
                'left': x
            });
            $("#content"+id).html(text);
            $("#"+id).draggable({
                handle: ".header",
                stop: function () {
                    // todo: change the position in the JSON file.
                    // alert("stopped " + id);
                    postitArray[id].x = $("#"+id).position().left;
                    postitArray[id].y = $("#"+id).position().top;
                    storage.set('postitarray', postitArray);
                }
            });
//            $(".content").on("click", stopPostItCreation);
            $("#content"+id).on("input",
                    function() {
                        var $this = $(this);
                        postitArray[id].pText = $("#content"+id).html();
                        storage.set('postitarray', postitArray);
                    }
            );
            $("#close"+id).on("click", deletePostIt);
        };

        function deletePostIt(e) {
            $("#"+id).remove();
            var $parent = $(this.parentElement.parentElement);
            $parent.remove();
            postitArray[id] = null;
            console.log(postitArray);
            storage.set('postitarray', postitArray);
        };

        initialize();
    };

    function buildNotes() {
        // now show on Screen ...
        if (postitArray[0] != undefined) {
            for (var i = 0; i < postitArray.length; i++) {
                new PostIt(i, postitArray[i].pText, postitArray[i].x, postitArray[i].y);
                postNumber++;
            }
        }
    }

    $(function () {
        new Board('#board');
        // storage.remove('postitarray');
        console.log(storage.get('postitarray'));
        var tmp = storage.get('postitarray');
        if (tmp != undefined) {
            for (var i = 0; i < tmp.length; i++) {
                if (tmp[i] != undefined) {
                    postitArray.push(tmp[i]);
                    postNumber++;
                }
            }
            if (postitArray.length > 0) buildNotes();
        }
    });

    $( window ).unload(function() {
        storage.set('postitarray', postitArray);
    });

    function resetBoard() {
        for (var i = 0; i <= postNumber; i++) {
            $("#"+i).remove();
        }
        postitArray = new Array();
        postNumber = -1;
        storage.remove('postitarray');
    }

    function newPostIt() {
        postNumber += 1;
        postitArray[postNumber] = new PostIt(postNumber, "", Math.round($(window).width() / 8 + $(window).width() / 2 * Math.random()), Math.round($(window).height() / 8 + $(window).height() / 2 * Math.random()));
        storage.set('postitarray', postitArray);
        console.log(postNumber)
        console.log(postitArray);
        console.log(storage.get('postitarray'));
    }
    ;
</script>
</body>
</html>